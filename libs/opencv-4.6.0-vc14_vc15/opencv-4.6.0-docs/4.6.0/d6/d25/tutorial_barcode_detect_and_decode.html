<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>OpenCV: Bar code Recognition</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
//<![CDATA[
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
          distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
          distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.6.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d3/d81/tutorial_contrib_root.html">Tutorials for contrib modules</a></li><li class="navelem"><a class="el" href="../../d6/d7b/tutorial_table_of_content_barcode.html">Tutorials for barcode module</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Bar code Recognition </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Goal </h2>
<p>In this chapter,</p>
<ul>
<li>We will familiarize with the bar code detection and decoding methods available in OpenCV.</li>
</ul>
<h2>Basics </h2>
<p>Bar code is major technique to identify commodity in real life. A common bar code is a pattern of parallel lines arranged by black bars and white bars with vastly different reflectivity. Bar code recognition is to scan the bar code in the horizontal direction to get a string of binary codes composed of bars of different widths and colors, that is, the code information of the bar code. The content of bar code can be decoded by matching with various bar code encoding methods. For current work, we only support EAN13 encoding method.</p>
<h3>EAN 13</h3>
<p>The EAN-13 bar code is based on the UPC-A standard, which was first implemented in Europe by the International Item Coding Association and later gradually spread worldwide. Most of the common goods in life use EAN-13 barcode.</p>
<p>for more detail see <a href="https://en.wikipedia.org/wiki/International_Article_Number">EAN - Wikipedia</a></p>
<h3>BarcodeDetector</h3>
<p>Several algorithms were introduced for bar code recognition.</p>
<p>While coding, we firstly need to create a <b><a class="el" href="../../dc/df7/classcv_1_1barcode_1_1BarcodeDetector.html">cv::barcode::BarcodeDetector</a></b> object. It has mainly three member functions, which will be introduced in the following.</p>
<h4>Initilization</h4>
<p>User can construct BarcodeDetector with super resolution model which should be downloaded automatically to <code>&lt;opencv_build_dir&gt;/downloads/barcode</code>. If not, please download them from <code><a href="https://github.com/WeChatCV/opencv_3rdparty/tree/wechat_qrcode">https://github.com/WeChatCV/opencv_3rdparty/tree/wechat_qrcode</a></code></p>
<p>or choose not to use super resolution.</p>
<div class="fragment"><div class="line">    <span class="keywordflow">try</span>{</div><div class="line">        bardet = makePtr&lt;barcode::BarcodeDetector&gt;(sr_prototxt, sr_model);</div><div class="line">    } <span class="keywordflow">catch</span> (<span class="keyword">const</span> std::exception&amp; e)</div><div class="line">    {</div><div class="line">        cout &lt;&lt;</div><div class="line">             <span class="stringliteral">&quot;\n---------------------------------------------------------------\n&quot;</span></div><div class="line">             <span class="stringliteral">&quot;Failed to initialize super resolution.\n&quot;</span></div><div class="line">             <span class="stringliteral">&quot;Please, download &#39;sr.*&#39; from\n&quot;</span></div><div class="line">             <span class="stringliteral">&quot;https://github.com/WeChatCV/opencv_3rdparty/tree/wechat_qrcode\n&quot;</span></div><div class="line">             <span class="stringliteral">&quot;and put them into the current directory.\n&quot;</span></div><div class="line">             <span class="stringliteral">&quot;Or you can leave sr_prototxt and sr_model unspecified.\n&quot;</span></div><div class="line">             <span class="stringliteral">&quot;---------------------------------------------------------------\n&quot;</span>;</div><div class="line">        cout &lt;&lt; e.what() &lt;&lt; endl;</div><div class="line">        <span class="keywordflow">return</span> -1;</div><div class="line">    }</div></div><!-- fragment --><p>We need create variables to store the outputs. </p><div class="fragment"><div class="line">        vector&lt;cv::String&gt; decode_info;</div><div class="line">        vector&lt;barcode::BarcodeType&gt; decoded_type;</div><div class="line">        vector&lt;Point&gt; corners;</div></div><!-- fragment --> <h4>detect</h4>
<p>It is a algorithm based on directional coherence. First of all, we compute the average squared gradients of every pixels. It was proposed in the paper "Systematic methods for the computation of the directional fields and singular points of fingerprints" by A.M. Bazen and S.H. Gerez in 2002. Then we divide the image into some square patches and compute the <b>gradient orientation coherence</b> and <b>mean gradient direction</b> of each patch. At last we connected the patches that have <b>high gradient orientation coherence</b> and <b>similar gradient direction</b>. In this stage, we use multi-scale patches to capture the gradient distribution of multi-size bar codes, and apply non-maximum suppression to filter duplicate proposals. A last, we use <a class="el" href="../../d3/dc0/group__imgproc__shape.html#ga3d476a3417130ae5154aea421ca7ead9" title="Finds a rotated rectangle of the minimum area enclosing the input 2D point set. ">minAreaRect()</a> to bound the ROI, and output the corners of the rectangles.</p>
<p>Detect codes in the input image, and output the corners of detected rectangles:</p>
<div class="fragment"><div class="line">        <span class="keywordtype">bool</span> result_detection = bardet-&gt;detect(input, corners);</div></div><!-- fragment --> <h4>decode</h4>
<p>This function first super-scales the image if it is smaller than threshold, sharpens the image and then binaries it by OTSU or local-binarization. At last reads the contents of the barcode by matching the similarity of the specified barcode pattern. Only EAN-13 barcode currently supported.</p>
<p>You can find more information in <b><a class="el" href="../../dc/df7/classcv_1_1barcode_1_1BarcodeDetector.html#a51bbcb8904ba4a237db0aaff62d9ec6d" title="Decodes barcode in image once it&#39;s found by the detect() method. ">cv::barcode::BarcodeDetector::decode()</a></b>.</p>
<h4>detectAndDecode</h4>
<p>This function combines <code>detect</code> and <code>decode</code>. A simple example below to use this function showing recognized bar codes.</p>
<div class="fragment"><div class="line">        <span class="keywordtype">bool</span> result_detection = bardet-&gt;detectAndDecode(input, decode_info, decode_type, corners);</div></div><!-- fragment --><p> Visualize the results: </p><div class="fragment"><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> drawFPS(Mat &amp;color_image, <span class="keywordtype">double</span> fps)</div><div class="line">{</div><div class="line">    ostringstream convert;</div><div class="line">    convert &lt;&lt; cv::format(<span class="stringliteral">&quot;%.2f&quot;</span>, fps) &lt;&lt; <span class="stringliteral">&quot; FPS (&quot;</span> &lt;&lt; (g_detectOnly ? <span class="stringliteral">&quot; detector&quot;</span> : <span class="stringliteral">&quot; decoder&quot;</span>) &lt;&lt; <span class="stringliteral">&quot;)&quot;</span>;</div><div class="line">    <a class="code" href="../../d6/d6e/group__imgproc__draw.html#ga5126f47f883d730f633d74f07456c576">putText</a>(color_image, convert.str(), <a class="code" href="../../dc/d84/group__core__basic.html#ga1e83eafb2d26b3c93f09e8338bcab192">Point</a>(25, 25), <a class="code" href="../../d6/d6e/group__imgproc__draw.html#gga0f9314ea6e35f99bb23f29567fc16e11ab307bdc73fdd06074acad940115bda7a">FONT_HERSHEY_DUPLEX</a>, 1, <a class="code" href="../../dc/d84/group__core__basic.html#ga599fe92e910c027be274233eccad7beb">Scalar</a>(0, 0, 255), 2);</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> drawBarcodeResults(Mat &amp;frame, <span class="keyword">const</span> vector&lt;Point&gt; &amp;corners, <span class="keyword">const</span> vector&lt;cv::String&gt; &amp;decode_info,</div><div class="line">                               <span class="keyword">const</span> vector&lt;cv::barcode::BarcodeType&gt; &amp;decode_type, <span class="keywordtype">double</span> fps)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (!corners.empty())</div><div class="line">    {</div><div class="line">        <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; corners.size(); i += 4)</div><div class="line">        {</div><div class="line">            <span class="keywordtype">size_t</span> bar_idx = i / 4;</div><div class="line">            vector&lt;Point&gt; barcode_contour(corners.begin() + i, corners.begin() + i + 4);</div><div class="line">            drawBarcodeContour(frame, barcode_contour, g_detectOnly || decode_type[bar_idx] != <a class="code" href="../../d2/dea/group__barcode.html#ggad68a748c2df685e81b96c7429b899d2cabd8c08da22e5bb4c7fe157fcf52f5083">barcode::NONE</a>);</div><div class="line"></div><div class="line">            cout &lt;&lt; <span class="stringliteral">&quot;BAR[&quot;</span> &lt;&lt; bar_idx &lt;&lt; <span class="stringliteral">&quot;] @ &quot;</span> &lt;&lt; Mat(barcode_contour).reshape(2, 1) &lt;&lt; <span class="stringliteral">&quot;: &quot;</span>;</div><div class="line">            <span class="keywordflow">if</span> (decode_info.size() &gt; bar_idx)</div><div class="line">            {</div><div class="line">                <span class="keywordflow">if</span> (!decode_info[bar_idx].empty())</div><div class="line">                {</div><div class="line">                    cout &lt;&lt; <span class="stringliteral">&quot;TYPE: &quot;</span> &lt;&lt; decode_type[bar_idx] &lt;&lt; <span class="stringliteral">&quot; INFO: &quot;</span> &lt;&lt; decode_info[bar_idx] &lt;&lt; endl;</div><div class="line">                }</div><div class="line">                <span class="keywordflow">else</span></div><div class="line">                {</div><div class="line">                    cout &lt;&lt; <span class="stringliteral">&quot;can&#39;t decode 1D barcode&quot;</span> &lt;&lt; endl;</div><div class="line">                }</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                cout &lt;&lt; <span class="stringliteral">&quot;decode information is not available (disabled)&quot;</span> &lt;&lt; endl;</div><div class="line">            }</div><div class="line">        }</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span></div><div class="line">    {</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;Barcode is not detected&quot;</span> &lt;&lt; endl;</div><div class="line">    }</div><div class="line"></div><div class="line">    drawFPS(frame, fps);</div><div class="line">}</div></div><!-- fragment --> <h2>Results </h2>
<p><b>Original Image</b></p>
<p>Below image shows four EAN 13 bar codes photoed by a smart phone.</p>
<div class="image">
<img src="../../4_barcodes.jpg" alt="4_barcodes.jpg"/>
<div class="caption">
image</div></div>
<p> <b>Result of detectAndDecode</b></p>
<p>Bar codes are bounded by green box, and decoded numbers are lying on the boxes.</p>
<div class="image">
<img src="../../result.jpg" alt="result.jpg"/>
<div class="caption">
image</div></div>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 5 2022 16:19:55 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
