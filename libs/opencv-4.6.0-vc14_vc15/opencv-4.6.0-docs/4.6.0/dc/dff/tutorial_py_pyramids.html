<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>OpenCV: Image Pyramids</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
//<![CDATA[
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
          distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
          distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.6.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d6/d00/tutorial_py_root.html">OpenCV-Python Tutorials</a></li><li class="navelem"><a class="el" href="../../d2/d96/tutorial_py_table_of_contents_imgproc.html">Image Processing in OpenCV</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Image Pyramids </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Goal </h2>
<p>In this chapter,</p><ul>
<li>We will learn about Image Pyramids</li>
<li>We will use Image pyramids to create a new fruit, "Orapple"</li>
<li>We will see these functions: <b><a class="el" href="../../d4/d86/group__imgproc__filter.html#gada75b59bdaaca411ed6fee10085eb784" title="Upsamples an image and then blurs it. ">cv.pyrUp()</a></b>, <b><a class="el" href="../../d4/d86/group__imgproc__filter.html#gaf9bba239dfca11654cb7f50f889fc2ff" title="Blurs an image and downsamples it. ">cv.pyrDown()</a></b></li>
</ul>
<h2>Theory </h2>
<p>Normally, we used to work with an image of constant size. But on some occasions, we need to work with (the same) images in different resolution. For example, while searching for something in an image, like face, we are not sure at what size the object will be present in said image. In that case, we will need to create a set of the same image with different resolutions and search for object in all of them. These set of images with different resolutions are called <b>Image Pyramids</b> (because when they are kept in a stack with the highest resolution image at the bottom and the lowest resolution image at top, it looks like a pyramid).</p>
<p>There are two kinds of Image Pyramids. 1) <b>Gaussian Pyramid</b> and 2) <b>Laplacian Pyramids</b></p>
<p>Higher level (Low resolution) in a Gaussian Pyramid is formed by removing consecutive rows and columns in Lower level (higher resolution) image. Then each pixel in higher level is formed by the contribution from 5 pixels in underlying level with gaussian weights. By doing so, a \(M \times N\) image becomes \(M/2 \times N/2\) image. So area reduces to one-fourth of original area. It is called an Octave. The same pattern continues as we go upper in pyramid (ie, resolution decreases). Similarly while expanding, area becomes 4 times in each level. We can find Gaussian pyramids using <b><a class="el" href="../../d4/d86/group__imgproc__filter.html#gaf9bba239dfca11654cb7f50f889fc2ff" title="Blurs an image and downsamples it. ">cv.pyrDown()</a></b> and <b><a class="el" href="../../d4/d86/group__imgproc__filter.html#gada75b59bdaaca411ed6fee10085eb784" title="Upsamples an image and then blurs it. ">cv.pyrUp()</a></b> functions. </p><div class="fragment"><div class="line">img = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">cv.imread</a>(<span class="stringliteral">&#39;messi5.jpg&#39;</span>)</div><div class="line">lower_reso = <a class="code" href="../../d4/d86/group__imgproc__filter.html#gaf9bba239dfca11654cb7f50f889fc2ff">cv.pyrDown</a>(higher_reso)</div></div><!-- fragment --><p> Below is the 4 levels in an image pyramid.</p>
<div class="image">
<img src="../../messipyr.jpg" alt="messipyr.jpg"/>
<div class="caption">
image</div></div>
<p> Now you can go down the image pyramid with <b><a class="el" href="../../d4/d86/group__imgproc__filter.html#gada75b59bdaaca411ed6fee10085eb784" title="Upsamples an image and then blurs it. ">cv.pyrUp()</a></b> function. </p><div class="fragment"><div class="line">higher_reso2 = <a class="code" href="../../d4/d86/group__imgproc__filter.html#gada75b59bdaaca411ed6fee10085eb784">cv.pyrUp</a>(lower_reso)</div></div><!-- fragment --><p> Remember, higher_reso2 is not equal to higher_reso, because once you decrease the resolution, you loose the information. Below image is 3 level down the pyramid created from smallest image in previous case. Compare it with original image:</p>
<div class="image">
<img src="../../messiup.jpg" alt="messiup.jpg"/>
<div class="caption">
image</div></div>
<p> Laplacian Pyramids are formed from the Gaussian Pyramids. There is no exclusive function for that. Laplacian pyramid images are like edge images only. Most of its elements are zeros. They are used in image compression. A level in Laplacian Pyramid is formed by the difference between that level in Gaussian Pyramid and expanded version of its upper level in Gaussian Pyramid. The three levels of a Laplacian level will look like below (contrast is adjusted to enhance the contents):</p>
<div class="image">
<img src="../../lap.jpg" alt="lap.jpg"/>
<div class="caption">
image</div></div>
 <h2>Image Blending using Pyramids </h2>
<p>One application of Pyramids is Image Blending. For example, in image stitching, you will need to stack two images together, but it may not look good due to discontinuities between images. In that case, image blending with Pyramids gives you seamless blending without leaving much data in the images. One classical example of this is the blending of two fruits, Orange and Apple. See the result now itself to understand what I am saying:</p>
<div class="image">
<img src="../../orapple.jpg" alt="orapple.jpg"/>
<div class="caption">
image</div></div>
<p> Please check first reference in additional resources, it has full diagramatic details on image blending, Laplacian Pyramids etc. Simply it is done as follows:</p>
<ol type="1">
<li>Load the two images of apple and orange</li>
<li>Find the Gaussian Pyramids for apple and orange (in this particular example, number of levels is 6)</li>
<li>From Gaussian Pyramids, find their Laplacian Pyramids</li>
<li>Now join the left half of apple and right half of orange in each levels of Laplacian Pyramids</li>
<li>Finally from this joint image pyramids, reconstruct the original image.</li>
</ol>
<p>Below is the full code. (For sake of simplicity, each step is done separately which may take more memory. You can optimize it if you want so). </p><div class="fragment"><div class="line"><span class="keyword">import</span> cv2 <span class="keyword">as</span> cv</div><div class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np,sys</div><div class="line"></div><div class="line">A = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">cv.imread</a>(<span class="stringliteral">&#39;apple.jpg&#39;</span>)</div><div class="line">B = <a class="code" href="../../d4/da8/group__imgcodecs.html#ga288b8b3da0892bd651fce07b3bbd3a56">cv.imread</a>(<span class="stringliteral">&#39;orange.jpg&#39;</span>)</div><div class="line"></div><div class="line"><span class="comment"># generate Gaussian pyramid for A</span></div><div class="line">G = A.copy()</div><div class="line">gpA = [G]</div><div class="line"><span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(6):</div><div class="line">    G = <a class="code" href="../../d4/d86/group__imgproc__filter.html#gaf9bba239dfca11654cb7f50f889fc2ff">cv.pyrDown</a>(G)</div><div class="line">    gpA.append(G)</div><div class="line"></div><div class="line"><span class="comment"># generate Gaussian pyramid for B</span></div><div class="line">G = B.copy()</div><div class="line">gpB = [G]</div><div class="line"><span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(6):</div><div class="line">    G = <a class="code" href="../../d4/d86/group__imgproc__filter.html#gaf9bba239dfca11654cb7f50f889fc2ff">cv.pyrDown</a>(G)</div><div class="line">    gpB.append(G)</div><div class="line"></div><div class="line"><span class="comment"># generate Laplacian Pyramid for A</span></div><div class="line">lpA = [gpA[5]]</div><div class="line"><span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(5,0,-1):</div><div class="line">    GE = <a class="code" href="../../d4/d86/group__imgproc__filter.html#gada75b59bdaaca411ed6fee10085eb784">cv.pyrUp</a>(gpA[i])</div><div class="line">    L = <a class="code" href="../../d2/de8/group__core__array.html#gaa0f00d98b4b5edeaeb7b8333b2de353b">cv.subtract</a>(gpA[i-1],GE)</div><div class="line">    lpA.append(L)</div><div class="line"></div><div class="line"><span class="comment"># generate Laplacian Pyramid for B</span></div><div class="line">lpB = [gpB[5]]</div><div class="line"><span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(5,0,-1):</div><div class="line">    GE = <a class="code" href="../../d4/d86/group__imgproc__filter.html#gada75b59bdaaca411ed6fee10085eb784">cv.pyrUp</a>(gpB[i])</div><div class="line">    L = <a class="code" href="../../d2/de8/group__core__array.html#gaa0f00d98b4b5edeaeb7b8333b2de353b">cv.subtract</a>(gpB[i-1],GE)</div><div class="line">    lpB.append(L)</div><div class="line"></div><div class="line"><span class="comment"># Now add left and right halves of images in each level</span></div><div class="line">LS = []</div><div class="line"><span class="keywordflow">for</span> la,lb <span class="keywordflow">in</span> zip(lpA,lpB):</div><div class="line">    rows,cols,dpt = la.shape</div><div class="line">    ls = np.hstack((la[:,0:cols//2], lb[:,cols//2:]))</div><div class="line">    LS.append(ls)</div><div class="line"></div><div class="line"><span class="comment"># now reconstruct</span></div><div class="line">ls_ = LS[0]</div><div class="line"><span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(1,6):</div><div class="line">    ls_ = <a class="code" href="../../d4/d86/group__imgproc__filter.html#gada75b59bdaaca411ed6fee10085eb784">cv.pyrUp</a>(ls_)</div><div class="line">    ls_ = <a class="code" href="../../d2/de8/group__core__array.html#ga10ac1bfb180e2cfda1701d06c24fdbd6">cv.add</a>(ls_, LS[i])</div><div class="line"></div><div class="line"><span class="comment"># image with direct connecting each half</span></div><div class="line">real = np.hstack((A[:,:cols//2],B[:,cols//2:]))</div><div class="line"></div><div class="line"><a class="code" href="../../d4/da8/group__imgcodecs.html#gabbc7ef1aa2edfaa87772f1202d67e0ce">cv.imwrite</a>(<span class="stringliteral">&#39;Pyramid_blending2.jpg&#39;</span>,ls_)</div><div class="line"><a class="code" href="../../d4/da8/group__imgcodecs.html#gabbc7ef1aa2edfaa87772f1202d67e0ce">cv.imwrite</a>(<span class="stringliteral">&#39;Direct_blending.jpg&#39;</span>,real)</div></div><!-- fragment --> <h2>Additional Resources </h2>
<ol type="1">
<li><a href="http://pages.cs.wisc.edu/~csverma/CS766_09/ImageMosaic/imagemosaic.html">Image Blending</a></li>
</ol>
<h2>Exercises </h2>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 5 2022 16:19:55 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
