<!-- HTML header for doxygen 1.8.6-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<title>OpenCV: Interactive camera calibration application</title>
<link href="../../opencv.ico" rel="shortcut icon" type="image/x-icon" />
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<script type="text/javascript" src="../../tutorial-utils.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js", "TeX/AMSmath.js", "TeX/AMSsymbols.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
//<![CDATA[
MathJax.Hub.Config(
{
  TeX: {
      Macros: {
          matTT: [ "\\[ \\left|\\begin{array}{ccc} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{array}\\right| \\]", 9],
          fork: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ \\end{array} \\right.", 4],
          forkthree: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ \\end{array} \\right.", 6],
          forkfour: ["\\left\\{ \\begin{array}{l l} #1 & \\mbox{#2}\\\\ #3 & \\mbox{#4}\\\\ #5 & \\mbox{#6}\\\\ #7 & \\mbox{#8}\\\\ \\end{array} \\right.", 8],
          vecthree: ["\\begin{bmatrix} #1\\\\ #2\\\\ #3 \\end{bmatrix}", 3],
          vecthreethree: ["\\begin{bmatrix} #1 & #2 & #3\\\\ #4 & #5 & #6\\\\ #7 & #8 & #9 \\end{bmatrix}", 9],
          cameramatrix: ["#1 = \\begin{bmatrix} f_x & 0 & c_x\\\\ 0 & f_y & c_y\\\\ 0 & 0 & 1 \\end{bmatrix}", 1],
          distcoeffs: ["(k_1, k_2, p_1, p_2[, k_3[, k_4, k_5, k_6 [, s_1, s_2, s_3, s_4[, \\tau_x, \\tau_y]]]]) \\text{ of 4, 5, 8, 12 or 14 elements}"],
          distcoeffsfisheye: ["(k_1, k_2, k_3, k_4)"],
          hdotsfor: ["\\dots", 1],
          mathbbm: ["\\mathbb{#1}", 1],
          bordermatrix: ["\\matrix{#1}", 1]
      }
  }
}
);
//]]>
</script><script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<!--#include virtual="/google-search.html"-->
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="../../opencv-logo-small.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">OpenCV
   &#160;<span id="projectnumber">4.6.0</span>
   </div>
   <div id="projectbrief">Open Source Computer Vision</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "../../search",false,'Search');
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="../../d9/df8/tutorial_root.html">OpenCV Tutorials</a></li><li class="navelem"><a class="el" href="../../d6/d55/tutorial_table_of_content_calib3d.html">Camera calibration and 3D reconstruction (calib3d module)</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Interactive camera calibration application </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><b>Prev Tutorial:</b> <a class="el" href="../../dc/d2c/tutorial_real_time_pose.html">Real Time pose estimation of a textured object</a></p>
<table class="doxtable">
<tr>
<th align="right"></th><th align="left"></th></tr>
<tr>
<td align="right">Original author </td><td align="left">Vladislav Sovrasov </td></tr>
<tr>
<td align="right">Compatibility </td><td align="left">OpenCV &gt;= 3.1 </td></tr>
</table>
<p>According to classical calibration technique user must collect all data first and when run <a class="el" href="../../d9/d0c/group__calib3d.html#ga3207604e4b1a1758aa66acb6ed5aa65d">cv::calibrateCamera</a> function to obtain camera parameters. If average re-projection error is huge or if estimated parameters seems to be wrong, process of selection or collecting data and starting of <a class="el" href="../../d9/d0c/group__calib3d.html#ga3207604e4b1a1758aa66acb6ed5aa65d">cv::calibrateCamera</a> repeats.</p>
<p>Interactive calibration process assumes that after each new data portion user can see results and errors estimation, also he can delete last data portion and finally, when dataset for calibration is big enough starts process of auto data selection.</p>
<h2>Main application features </h2>
<p>The sample application will:</p>
<ul>
<li>Determine the distortion matrix and confidence interval for each element</li>
<li>Determine the camera matrix and confidence interval for each element</li>
<li>Take input from camera or video file</li>
<li>Read configuration from XML file</li>
<li>Save the results into XML file</li>
<li>Calculate re-projection error</li>
<li>Reject patterns views on sharp angles to prevent appear of ill-conditioned jacobian blocks</li>
<li>Auto switch calibration flags (fix aspect ratio and elements of distortion matrix if needed)</li>
<li>Auto detect when calibration is done by using several criteria</li>
<li>Auto capture of static patterns (user doesn't need press any keys to capture frame, just don't move pattern for a second)</li>
</ul>
<p>Supported patterns:</p>
<ul>
<li>Black-white chessboard</li>
<li>Asymmetrical circle pattern</li>
<li>Dual asymmetrical circle pattern</li>
<li>chAruco (chessboard with Aruco markers)</li>
</ul>
<h2>Description of parameters </h2>
<p>Application has two groups of parameters: primary (passed through command line) and advances (passed through XML file).</p>
<h3>Primary parameters:</h3>
<p>All of this parameters are passed to application through a command line.</p>
<p>-[parameter]=[default value]: description</p>
<ul>
<li>-v=[filename]: get video from filename, default input &ndash; camera with id=0</li>
<li>-ci=[0]: get video from camera with specified id</li>
<li>-flip=[false]: vertical flip of input frames</li>
<li>-t=[circles]: pattern for calibration (circles, chessboard, dualCircles, chAruco)</li>
<li>-sz=[16.3]: distance between two nearest centers of circles or squares on calibration board</li>
<li>-dst=[295] distance between white and black parts of daulCircles pattern</li>
<li>-w=[width]: width of pattern (in corners or circles)</li>
<li>-h=[height]: height of pattern (in corners or circles)</li>
<li>-of=[camParams.xml]: output file name</li>
<li>-ft=[true]: auto tuning of calibration flags</li>
<li>-vis=[grid]: captured boards visualization (grid, window)</li>
<li>-d=[0.8]: delay between captures in seconds</li>
<li>-pf=[defaultConfig.xml]: advanced application parameters file</li>
</ul>
<h3>Advanced parameters:</h3>
<p>By default values of advanced parameters are stored in defaultConfig.xml</p>
<div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;<span class="keywordtype">opencv_storage</span>&gt;</div><div class="line">&lt;<span class="keywordtype">charuco_dict</span>&gt;0&lt;/<span class="keywordtype">charuco_dict</span>&gt;</div><div class="line">&lt;<span class="keywordtype">charuco_square_length</span>&gt;200&lt;/<span class="keywordtype">charuco_square_length</span>&gt;</div><div class="line">&lt;<span class="keywordtype">charuco_marker_size</span>&gt;100&lt;/<span class="keywordtype">charuco_marker_size</span>&gt;</div><div class="line">&lt;<span class="keywordtype">calibration_step</span>&gt;1&lt;/<span class="keywordtype">calibration_step</span>&gt;</div><div class="line">&lt;<span class="keywordtype">max_frames_num</span>&gt;30&lt;/<span class="keywordtype">max_frames_num</span>&gt;</div><div class="line">&lt;<span class="keywordtype">min_frames_num</span>&gt;10&lt;/<span class="keywordtype">min_frames_num</span>&gt;</div><div class="line">&lt;<span class="keywordtype">solver_eps</span>&gt;1<span class="keyword">e-7</span>&lt;/<span class="keywordtype">solver_eps</span>&gt;</div><div class="line">&lt;<span class="keywordtype">solver_max_iters</span>&gt;30&lt;/<span class="keywordtype">solver_max_iters</span>&gt;</div><div class="line">&lt;<span class="keywordtype">fast_solver</span>&gt;0&lt;/<span class="keywordtype">fast_solver</span>&gt;</div><div class="line">&lt;<span class="keywordtype">frame_filter_conv_param</span>&gt;0.1&lt;/<span class="keywordtype">frame_filter_conv_param</span>&gt;</div><div class="line">&lt;<span class="keywordtype">camera_resolution</span>&gt;1280 720&lt;/<span class="keywordtype">camera_resolution</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">opencv_storage</span>&gt;</div></div><!-- fragment --><ul>
<li><em>charuco_dict</em>: name of special dictionary, which has been used for generation of chAruco pattern</li>
<li><em>charuco_square_length</em>: size of square on chAruco board (in pixels)</li>
<li><em>charuco_marker_size</em>: size of Aruco markers on chAruco board (in pixels)</li>
<li><em>calibration_step</em>: interval in frames between launches of <a class="el" href="../../d9/d0c/group__calib3d.html#ga3207604e4b1a1758aa66acb6ed5aa65d">cv::calibrateCamera</a></li>
<li><em>max_frames_num</em>: if number of frames for calibration is greater then this value frames filter starts working. After filtration size of calibration dataset is equals to <em>max_frames_num</em></li>
<li><em>min_frames_num</em>: if number of frames is greater then this value turns on auto flags tuning, undistorted view and quality evaluation</li>
<li><em>solver_eps</em>: precision of Levenberg-Marquardt solver in <a class="el" href="../../d9/d0c/group__calib3d.html#ga3207604e4b1a1758aa66acb6ed5aa65d">cv::calibrateCamera</a></li>
<li><em>solver_max_iters</em>: iterations limit of solver</li>
<li><em>fast_solver</em>: if this value is nonzero and Lapack is found QR decomposition is used instead of SVD in solver. QR faster than SVD, but potentially less precise</li>
<li><em>frame_filter_conv_param</em>: parameter which used in linear convolution of bicriterial frames filter</li>
<li><em>camera_resolution</em>: resolution of camera which is used for calibration</li>
</ul>
<p><b>Note:</b> <em>charuco_dict</em>, <em>charuco_square_length</em> and <em>charuco_marker_size</em> are used for chAruco pattern generation (see Aruco module description for details: <a href="https://github.com/opencv/opencv_contrib/tree/4.x/modules/aruco/tutorials">Aruco tutorials</a>)</p>
<p>Default chAruco pattern:</p>
<div class="image">
<img src="../../charuco_board.png" alt="charuco_board.png"/>
</div>
<h2>Dual circles pattern </h2>
<p>To make this pattern you need standard OpenCV circles pattern and binary inverted one. Place two patterns on one plane in order when all horizontal lines of circles in one pattern are continuations of similar lines in another. Measure distance between patterns as shown at picture below pass it as <b>dst</b> command line parameter. Also measure distance between centers of nearest circles and pass this value as <b>sz</b> command line parameter.</p>
<div class="image">
<img src="../../dualCircles.jpg" alt="dualCircles.jpg"/>
</div>
<p>This pattern is very sensitive to quality of production and measurements.</p>
<h2>Data filtration </h2>
<p>When size of calibration dataset is greater then <em>max_frames_num</em> starts working data filter. It tries to remove "bad" frames from dataset. Filter removes the frame on which \(loss\_function\) takes maximum.</p>
<p class="formulaDsp">
\[loss\_function(i)=\alpha RMS(i)+(1-\alpha)reducedGridQuality(i)\]
</p>
<p><b>RMS</b> is an average re-projection error calculated for frame <em>i</em>, <b>reducedGridQuality</b> is scene coverage quality evaluation without frame <em>i</em>. \(\alpha\) is equals to <b>frame_filter_conv_param</b>.</p>
<h2>Calibration process </h2>
<p>To start calibration just run application. Place pattern ahead the camera and fixate pattern in some pose. After that wait for capturing (will be shown message like "Frame #i captured"). Current focal distance and re-projection error will be shown at the main screen. Move pattern to the next position and repeat procedure. Try to cover image plane uniformly and don't show pattern on sharp angles to the image plane.</p>
<div class="image">
<img src="../../screen_charuco.jpg" alt="screen_charuco.jpg"/>
</div>
<p>If calibration seems to be successful (confidence intervals and average re-projection error are small, frame coverage quality and number of pattern views are big enough) application will show a message like on screen below.</p>
<div class="image">
<img src="../../screen_finish.jpg" alt="screen_finish.jpg"/>
</div>
<p>Hot keys:</p>
<ul>
<li>Esc &ndash; exit application</li>
<li>s &ndash; save current data to XML file</li>
<li>r &ndash; delete last frame</li>
<li>d &ndash; delete all frames</li>
<li>u &ndash; enable/disable applying of undistortion</li>
<li>v &ndash; switch visualization mode</li>
</ul>
<h2>Results </h2>
<p>As result you will get camera parameters and confidence intervals for them.</p>
<p>Example of output XML file:</p>
<div class="fragment"><div class="line">&lt;?<span class="keyword">xml</span> <span class="keyword">version</span>=<span class="stringliteral">&quot;1.0&quot;</span>?&gt;</div><div class="line">&lt;<span class="keywordtype">opencv_storage</span>&gt;</div><div class="line">&lt;<span class="keywordtype">calibrationDate</span>&gt;<span class="stringliteral">&quot;Thu 07 Apr 2016 04:23:03 PM MSK&quot;</span>&lt;/<span class="keywordtype">calibrationDate</span>&gt;</div><div class="line">&lt;<span class="keywordtype">framesCount</span>&gt;21&lt;/<span class="keywordtype">framesCount</span>&gt;</div><div class="line">&lt;<span class="keywordtype">cameraResolution</span>&gt;</div><div class="line">  1280 720&lt;/<span class="keywordtype">cameraResolution</span>&gt;</div><div class="line">&lt;<span class="keywordtype">cameraMatrix</span> <span class="keyword">type_id</span>=<span class="stringliteral">&quot;opencv-matrix&quot;</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">rows</span>&gt;3&lt;/<span class="keywordtype">rows</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">cols</span>&gt;3&lt;/<span class="keywordtype">cols</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">dt</span>&gt;<span class="keyword">d</span>&lt;/<span class="keywordtype">dt</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">data</span>&gt;</div><div class="line">    1.2519588293098975<span class="keyword">e</span>+03 0. 6.6684948780852471<span class="keyword">e</span>+02 0.</div><div class="line">    1.2519588293098975<span class="keyword">e</span>+03 3.6298123112613683<span class="keyword">e</span>+02 0. 0. 1.&lt;/<span class="keywordtype">data</span>&gt;&lt;/<span class="keywordtype">cameraMatrix</span>&gt;</div><div class="line">&lt;<span class="keywordtype">cameraMatrix_std_dev</span> <span class="keyword">type_id</span>=<span class="stringliteral">&quot;opencv-matrix&quot;</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">rows</span>&gt;4&lt;/<span class="keywordtype">rows</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">cols</span>&gt;1&lt;/<span class="keywordtype">cols</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">dt</span>&gt;<span class="keyword">d</span>&lt;/<span class="keywordtype">dt</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">data</span>&gt;</div><div class="line">    0. 1.2887048808572649<span class="keyword">e</span>+01 2.8536856683866230<span class="keyword">e</span>+00</div><div class="line">    2.8341737483430314<span class="keyword">e</span>+00&lt;/<span class="keywordtype">data</span>&gt;&lt;/<span class="keywordtype">cameraMatrix_std_dev</span>&gt;</div><div class="line">&lt;<span class="keywordtype">dist_coeffs</span> <span class="keyword">type_id</span>=<span class="stringliteral">&quot;opencv-matrix&quot;</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">rows</span>&gt;1&lt;/<span class="keywordtype">rows</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">cols</span>&gt;5&lt;/<span class="keywordtype">cols</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">dt</span>&gt;<span class="keyword">d</span>&lt;/<span class="keywordtype">dt</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">data</span>&gt;</div><div class="line">    1.3569117181595716<span class="keyword">e-01</span> -8.2513063822554633<span class="keyword">e-01</span> 0. 0.</div><div class="line">    1.6412101575010554<span class="keyword">e</span>+00&lt;/<span class="keywordtype">data</span>&gt;&lt;/<span class="keywordtype">dist_coeffs</span>&gt;</div><div class="line">&lt;<span class="keywordtype">dist_coeffs_std_dev</span> <span class="keyword">type_id</span>=<span class="stringliteral">&quot;opencv-matrix&quot;</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">rows</span>&gt;5&lt;/<span class="keywordtype">rows</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">cols</span>&gt;1&lt;/<span class="keywordtype">cols</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">dt</span>&gt;<span class="keyword">d</span>&lt;/<span class="keywordtype">dt</span>&gt;</div><div class="line">  &lt;<span class="keywordtype">data</span>&gt;</div><div class="line">    1.5570675523402111<span class="keyword">e-02</span> 8.7229075437543435<span class="keyword">e-02</span> 0. 0.</div><div class="line">    1.8382427901856876<span class="keyword">e-01</span>&lt;/<span class="keywordtype">data</span>&gt;&lt;/<span class="keywordtype">dist_coeffs_std_dev</span>&gt;</div><div class="line">&lt;<span class="keywordtype">avg_reprojection_error</span>&gt;4.2691743074130178<span class="keyword">e-01</span>&lt;/<span class="keywordtype">avg_reprojection_error</span>&gt;</div><div class="line">&lt;/<span class="keywordtype">opencv_storage</span>&gt;</div></div><!-- fragment --> </div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.6-->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Sun Jun 5 2022 16:19:50 for OpenCV by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="../../doxygen.png" alt="doxygen"/>
</a> 1.8.13
</small></address>
<script type="text/javascript">
//<![CDATA[
addTutorialsButtons();
//]]>
</script>
</body>
</html>
